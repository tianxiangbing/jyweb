!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);var n;!function(t){t[t.rect=0]="rect",t[t.circle=1]="circle",t[t.text=2]="text"}(n=e.SHAPE||(e.SHAPE={}));e.default=class{constructor(t,e=n.rect,i="",r=0,o=0,a=0,h=0){this.stage=t,this.type=e,this.content=i,this.displayName="Sprite",this.r=0,this.offsetX=0,this.isAbsolute=!1,this.width=r,this.height=o,this.x=a,this.y=h;let l=s.default.transformPosition(t,{x:a,y:h});this.cx=l.x,this.cy=l.y,this.visible=!0}draw(){this.visible&&(this.type===n.text?(this.content.background&&s.default.drawRect(this.stage,this.content.background,this.width,this.height,this.x,this.y,this.isAbsolute),s.default.write(this.stage,this.content.text,this.x,this.y,this.content.font,this.content.fillStyle,this.isAbsolute)):s.default.draw(this.stage,this.content,this.x,this.y,this.width,this.height))}drawAbsolute(){let{x:t,y:e}=s.default.transformRelatePosition(this.stage,{x:this.cx,y:this.cy});this.x=t,this.y=e,this.draw()}hits(t,e=!1){let i=t.x+t.width/2,n=t.y+t.height/2;if(!this.visible||!t.visible)return!1;let r=e?s.default.transformPosition(this.stage,{x:this.x,y:this.y}):this;return!!(i>=r.x&&i<=r.x+this.width&&n>=r.y&&n<=r.y+this.height)}touchHits(t,e){let i=t.touches[0];this.hits({x:i.clientX,y:i.clientY,width:0,height:0,visible:!0},!this.isAbsolute)&&e&&e.call(this)}getCenter(){return[this.x+this.r,this.y+this.r]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10);e.JY=s.default,e.STATE=s.STATE;const n=i(6);e.Control=n.default;const r=i(12);e.Descript=r.default;const o=i(13);e.GameOver=o.default;const a=i(0);e.Sprite=a.default;const h=i(14);e.Stage=h.default;const l=i(16);e.Title=l.default;const c=i(2);e.lib=c.default},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5);const r={waitMoment(t){return s(this,void 0,void 0,(function*(){return new Promise(e=>{let i=setTimeout(()=>{clearTimeout(i),e()},t)})}))},hits:function(t,e,i=0){i=i||0;var s=!1,n=!1,r=e.width-i,o=t.width-i,a=e.height-i,h=t.height-i;return s=t.x>e.x?t.x-e.x<r:!(t.x<e.x)||e.x-t.x<o,n=t.y>e.y?t.y-e.y<a:!(t.y<e.y)||e.y-t.y<h,s&&n},write(t,e,i,s,n="20px Arial",r="#000000",o=!1){let a=t.context;a.font=n,a.fillStyle=r;let h=o?{x:i,y:s}:this.transformPosition(t,{x:i,y:s});i=h.x,s=h.y,a.fillText(e,i,s+parseInt(n))},draw(t,e,i,s,n,r,o,a,h,l){let c=t.context,u="string"==typeof e?this.caches[e]:e,d=this.transformPosition(t,{x:i,y:s});arguments[2]=d.x,arguments[3]=d.y;let f=Array.prototype.slice.call(arguments,2);f.unshift(u),c.drawImage.call(c,...f)},drawAbsolute(t,e,i,s,n,r,o,a,h,l){let c=t.context,u="string"==typeof e?this.caches[e]:e;arguments[2]=i,arguments[3]=s;let d=Array.prototype.slice.call(arguments,2);d.unshift(u),c.drawImage.call(c,...d)},transformRelatePosition(t,{x:e,y:i}){let{realWidth:s,realHeight:n,deviation:r,width:o,height:a}=t;return{x:e+(s-o)/2+r.x,y:i+(n-a)/2+r.y}},transformPosition(t,{x:e,y:i}){let{realWidth:s,realHeight:n,deviation:r}=t,o=s/2-t.width/2,a=n/2-t.height/2;return{x:(e-=r.x)-o,y:(i-=r.y)-a}},random:(t,e)=>Math.floor(Math.random()*(e-t)+t),caches:{},Hcaches:{},loadResources(t){let e=[];return new Promise((i,s)=>{for(let i in t)/\.(jpg|gif|png|bmg|jpeg)/.test(t[i])?e.push(new Promise((e,s)=>{let n=new Image;n.onload=()=>{this.caches[t[i]]=n,e(!0)},n.onerror=()=>{this.caches[t[i]]=n,n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",s({message:`加载失败：${t[i]}`})},n.src=t[i]})):/\.(mp3|wav|avi|m4a|aac)/.test(t[i])&&e.push(new Promise(e=>{let s=new Audio;s.addEventListener("canplay",()=>{this.caches[t[i]]=s,e()}),s.src=t[i]}));return Promise.all(e).catch(t=>{console.log("加载资源出错."),s(t)}).then(()=>{console.log("加载资源完成."),i()})})},isMobile:()=>navigator.userAgent.indexOf("Mobile")>-1,imageHRevert(t){if(!this.Hcaches[t]){let e=this.caches[t],i=document.createElement("canvas");i.width=e.width,i.height=e.height;let s=i.getContext("2d");s.translate(i.width,0),s.scale(-1,1),s.drawImage(e,0,0);let n=i.toDataURL("image/png"),r=new Image;r.src=n,this.Hcaches[t]=r,s=void 0,i=void 0}return this.Hcaches[t]},play(t){let e=this.caches[t];e.pause(),e.currentTime=0,e.play()},createCanvas:()=>n.default.createCanvas(),addEventListener:(t,e,i)=>n.default.addEventListener(t,e,i),removeEventListener:(t,e,i)=>n.default.removeEventListener(t,e,i),dispatchEvent:(t,e)=>n.default.dispatchEvent(t,e),innerView:(t,e,i)=>Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i,drawRect(t,e,i,s,n,r,o=!1){let a=o?{x:n,y:r}:this.transformPosition(t,{x:n,y:r}),h=a.x,l=a.y,c=t.context;c.save(),c.fillStyle=e,c.fillRect(h,l,i,s),c.restore()},drawStokeRect(t,e,i,s,n,r,o,a=!1){let h=a?{x:r,y:o}:this.transformPosition(t,{x:r,y:o}),l=h.x,c=h.y,u=t.context;u.save(),u.strokeStyle=e,u.lineWidth=i,u.strokeRect(l,c,s,n),u.restore()},getMaxMinVal:(t,e,i)=>i=Math.max(Math.min(t,i),e),getRandomItem:t=>t[Math.floor(Math.random()*t.length)],getRandomUniqueItems(t,e){const i=t.slice();for(let t=i.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i.slice(0,e)},generateRandomNumber(t,e){let i=[e],s=1-e;for(let e=1;e<t;e++)i.push(s/2),s/=2;let n=Math.random(),r=0;for(let e=0;e<t;e++)if(n<(r+=i[e]))return t-e;return t},generateLifebyLevel(t,e){let i=0;for(let s=1;s<=t;s++)i+=s*e;return i},decimalToPercent:(t,e=2)=>100*Number(t.toFixed(e))+"%"};["createCanvas","addEventListener","removeEventListener","dispatchEvent"].forEach(t=>{r[t]=n.default[t].bind(n.default)}),e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(4),r=i(0),o=i(7),a=i(8),h=i(15);var l,c,u;!function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.up=.1]="up",t[t.down=.2]="down"}(l=e.EDirection||(e.EDirection={})),function(t){t[t.standup=0]="standup",t.runing="runing",t.jump="jump",t.attack="attack",t.hit="hit",t.die="die",t.lieDown="lieDown"}(c=e.EStatus||(e.EStatus={})),function(t){t.standup="standup",t.runing="runing",t.jump="jump"}(e.EMotionState||(e.EMotionState={})),function(t){t.red="red",t.blue="blue"}(u||(u={}));class d{constructor(t,e,i,s,n,r,o){this.stage=t,this.type=e,this.x=i,this.y=s,this.max=n,this.current=r,this.roleWidth=o,this.height=3,this.width=10,this.width=3*this.roleWidth}draw(t,e,i){this.current=i,this.x=t-Math.abs(this.roleWidth-this.width)/2,this.y=e-30,s.lib.drawStokeRect(this.stage,this.type,.5,this.width,this.height,this.x,this.y);let n=this.current/(this.max/this.width);console.log(n,this.type,i),s.lib.drawRect(this.stage,this.type,n,this.height,this.x,this.y),s.lib.write(this.stage,`${this.current}/${this.max}`,this.x+10,this.y-15,"12px","#DEDEFE")}}e.default=class extends s.Sprite{constructor(t,e,i,n,h,f,p){super(t,e,i,n,h,f,p),this.displayName="Hero",this.speed={x:0,y:0},this.speedValue=3,this.name=Math.random().toString().split(".")[1],this.id=Math.random().toString().split(".")[1],this.msg="",this.content="images/role.png",this.status=c.standup,this.animate={},this.frame=0,this.direction=l.right,this.isOwner=!1,this.attackList=[],this.heros=[],this.rebots=[],this.killSecond={},this.mana=100,this.life=100,this.maxLife=100,this.isDie=!1,this.attacking=!1,this.aggressivity=20,this.died=!1,this.level=1,this.experience=100,this.defense=10,this.attackInfo=[],this.experienceValue=50,this.animate[c.runing]=new o.default([{content:"images/hero/APimg[10].png",w:20,h:55},{content:"images/hero/APimg[11].png",w:38,h:57},{content:"images/hero/APimg[12].png",w:49,h:54},{content:"images/hero/APimg[13].png",w:43,h:57}],null,this),this.animate[c.runing].speed=8,this.animate[c.standup]=new o.default([{content:"images/role.png",w:19,h:60}],null,this),this.animate[c.hit]=new o.default([{content:"images/hero/APimg[130].png",w:20,h:55}],()=>{this.status=c.standup},this),this.animate[c.hit].loopNum=10,this.animate[c.die]=new o.default([{content:"images/hero/APimg[180].png",w:58,h:15,y:1}],()=>{},this),this.animate[c.die].speed=1,this.animate[c.die].overCallback=()=>{this.status=c.lieDown},this.animate[c.die].loopNum=10,this.animate[c.lieDown]=new o.default([{content:"images/hero/APimg[184].png",w:58,h:15}],t=>{},this),this.animate[c.lieDown].loopNum=5,this.animate[c.lieDown].overCallback=()=>{this.visible=!1},this.animate[c.lieDown].speed=10;let g=5*String(this.name).length;this.nameSprite=new s.Sprite(this.stage,r.SHAPE.text,{text:this.id,font:"10px Arial"},g,20,this.x-10,this.y-30),this.nameSprite.offsetX=Math.abs(this.nameSprite.width-this.width)/2,this.blood=new d(this.stage,u.red,this.x,this.y-2,this.maxLife,this.life,this.width),this.blue=new d(this.stage,u.blue,this.x,this.y,100,this.mana,this.width),this.equip=new a.default}getAggressivity(){return this.getAttack()}getAttack(){let t=this.equip.attack*this.aggressivity+this.aggressivity;return Math.random()<this.equip.criticalHit&&(t*=2),t}getDefense(){return this.equip.defense*this.defense+this.defense}getExp(){return 10}talk(t){this.msg=t,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{clearTimeout(this.timer),this.timer=0,this.msg=""},5e3)}showMsg(){new s.Sprite(this.stage,r.SHAPE.text,{text:this.msg,font:"14px Arial",fillStyle:"blue"},100,20,this.x,this.y-50).draw()}move(t){this.status=c.runing,this.direction!==t&&(this.direction=t,this.draw())}moveAnimate(){switch(this.direction){case l.left:this.speed.x=-1*this.speedValue;break;case l.right:this.speed.x=this.speedValue;break;case l.up:this.speed.y=-1*this.speedValue;break;case l.down:this.speed.y=this.speedValue}this.x+=this.speed.x,this.y+=this.speed.y,this.x=Math.min(Math.max(0,this.x),this.stage.realWidth-this.width);let t=this.stage.realHeight/this.stage.realWidth*440-this.height;if(this.y=Math.min(Math.max(t,this.y),this.stage.realHeight-this.height),this.isOwner){let t=this.stage.deviation;t={x:t.x+this.speed.x,y:t.y+this.speed.y},this.stage.setDeviation(t,this)}}dataUpdate(t){let{x:e,y:i,status:s,direction:n,name:r,id:o}=t;this.x=e,this.y=i,this.direction=n,this.status=s,this.name=r,this.id=o,this.nameSprite.width=5*String(this.name).length,this.nameSprite.content.text=this.name}stop(){this.status=c.standup,this.speed.x=0,this.speed.y=0}draw(){this.frame++,this.died||(this.frame%100==0&&this.blue&&(this.mana=s.lib.getMaxMinVal(this.blue.max,0,this.mana+1)),this.status==c.runing&&this.moveAnimate());let t=this.animate[this.status].play();this.content=t.content,this.width=t.w,this.height=t.h,this.x=t.x,this.y=t.y;let e={x:this.x,y:this.y};l.left==this.direction&&(this.content=s.lib.imageHRevert(this.content)),this.nameSprite.y=this.y-30,this.nameSprite.x=this.x-this.nameSprite.offsetX,this.nameSprite.draw(),this.blood.draw(this.x,this.y-12,this.life),this.blue&&this.blue.draw(this.x,this.y,this.mana),super.draw(),this.x=e.x,this.y=e.y,this.msg&&this.showMsg(),this.killSecond[n.EAttackType.normal]>0&&this.killSecond[n.EAttackType.normal]--,this.killSecond[n.EAttackType.skill]>0&&this.killSecond[n.EAttackType.skill]--,this.attackList.forEach((t,e)=>{t.visible?(t.draw(),t.checkHits(this.heros,this.rebots)):(this.killSecond[t.atype]=0,this.attackList.splice(e,1))}),this.isOwner&&this.drawInfo(),this.drawAtackInfo()}drawAtackInfo(){for(let t=this.attackInfo.length-1;t>=0;t--){let e=this.attackInfo[t];0==e.time?this.attackInfo.splice(t,1):s.lib.write(this.stage,e.value.toString(),this.x,this.y-(50-e.time)),e.time--}}drawInfo(){let t=this.stage.width;s.lib.drawStokeRect(this.stage,"#999999",1,t,8,0,0,!0),s.lib.drawRect(this.stage,"#dddddd",t/this.getExp()*this.experienceValue,6,1,1,!0),s.lib.write(this.stage,`${this.experienceValue}/${this.getExp()}`,this.stage.width/2-10,0,"8px","#333",!0);let e=0;for(let t in this.equip)e++,s.lib.write(this.stage,`${t}:${this.equip[t]}`,10,20*e,"8px","#333",!0);s.lib.write(this.stage,"等级："+this.level.toString(),10,20*(e+1),"8px","#333",!0)}attack(t,e){(!this.killSecond[t]||this.killSecond[t]<=0)&&this.showAttack(t,e)}setHit(t){this.status=c.hit;let e=Math.max(0,t-this.getDefense());this.life=s.lib.getMaxMinVal(this.blood.max,0,this.life-e),this.attackInfo.push({time:20,value:e})}checkLife(){this.life<=0&&(this.life=0,this.die())}checkLevel(){let t=this.getExp();if(this.experienceValue>=t){this.level++,this.life=this.maxLife,this.blue.current=this.blue.max,this.experienceValue=0,this.main.levelup(),new h.default(this.stage,this).draw(t=>{console.log(t);for(let e in t)this.equip[e]+=t[e];this.main.goon()})}}die(){this.died=!0,this.status=c.die}showAttack(t,e){let i=new n.default(this.stage,this,t,this.x+this.direction*this.width,this.y+this.height/3,this.direction);i.manaConsume<=this.mana?(this.status=c.attack,this.killSecond[t]=i.second,this.animate[this.status]=new o.default([{content:"images/hero/APimg[29].png",w:27,h:60},{content:"images/hero/APimg[30].png",w:24,h:55}],()=>{this.attacking=!1,this.status=c.standup,this.mana=s.lib.getMaxMinVal(this.blue.max,0,this.mana-i.manaConsume),this.attackList.push(i)},this)):this.killSecond[t]=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),n=i(0),r=i(3),o=i(2);var a;!function(t){t[t.normal=0]="normal",t[t.skill=1]="skill"}(a=e.EAttackType||(e.EAttackType={}));e.default=class extends s.Sprite{constructor(t,e,i,s,o,h){switch(super(t,n.SHAPE.rect,"",20,20),this.atype=i,this.x=s,this.y=o,this.direct=h,this.speed={x:0,y:0},this.start={x:0,y:0},this.second=10,this.aggressivity=1,this.manaConsume=0,this.owner=e,i){case a.normal:this.content="images/attack.png",this.speedValue=15,this.distance=600,this.second=30,this.start={x:s,y:o};break;case a.skill:this.content="images/attack.png",this.speedValue=10,this.width=40,this.height=40,this.y-=20,this.distance=700,this.second=140,this.aggressivity=2,this.start={x:s,y:o},this.manaConsume=50}h==r.EDirection.left&&(this.x-=this.width),this.formatSpeed()}formatSpeed(){switch(this.direct){case r.EDirection.left:this.speed={x:-this.speedValue,y:0};break;case r.EDirection.right:this.speed={x:this.speedValue,y:0};break;case r.EDirection.up:this.speed={y:-this.speedValue,x:0};break;case r.EDirection.down:this.speed={y:this.speedValue,x:0}}}draw(){this.x+=this.speed.x,this.y+=this.speed.y,Math.abs(Math.abs(this.x)-Math.abs(this.start.x))>this.distance&&(this.visible=!1),super.draw()}checkHits(t,e){this.toHits(e)}toHits(t){t.forEach(t=>{if(!t.isDie&&t.id!=this.owner.id&&o.default.hits(this,t)){let e=this.owner.getAggressivity()*this.aggressivity;if(t.setHit(e),this.visible=!1,t.checkLife(),t.died&&"Hero"==this.owner.displayName){let e=t.getExp();this.owner.experienceValue+=e,this.owner.checkLevel()}}})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(11);let s=!1;window&&!window.hasOwnProperty("wx")||(s=!0);let n=!0;-1==navigator.userAgent.indexOf("Mobile")&&(n=!1);let r={};const o={createCanvas:()=>{if(s)return window.canvas;{let t=document.createElement("canvas");return t.height=document.documentElement.clientHeight,t.width=document.documentElement.clientWidth,t.style.position="absolute",t.style.top="0",t.style.left="0",document.body.append(t),t}},eventMap:{touchstart:"click",touchmove:"mousemove"},wrapEventType(t){return n?t:this.eventMap[t]||t},addEventListener(t,e,i){s?t.addEventListener(e,i):(e=this.wrapEventType(e),r[e]||(r[e]=[],t.addEventListener(e,this.handle.call(this,e),!1)),r[e].push(i))},handle:t=>e=>{e.stopPropagation(),e.preventDefault();let i=r[t];for(var s=0;s<i.length;s++)n||(e.touches=[e]),i[s](e)},removeEventListener(t,e,i){if(s)t.removeEventListener(e,i);else{e=this.wrapEventType(e);var n=r[e];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===i){n.splice(o,1);break}0!=n&&i||(console.log(4444),r[e]=[])}},dispatchEvent(t,e){if(s)t.dispatchEvent(e);else{let t=e.type;var i=r[t];if(i)for(var n=0;n<i.length;n++)i[n](e)}}};e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.rect=[140,140],this.moveRect=[50,50],this.elemPosition=[5,5],this.angle=0}create(){this.elem=document.createElement("div"),this.elem.className="control",this.elem.style.borderRadius="100%",this.elem.style.backgroundColor="#333",this.elem.style.opacity="0.6",this.elem.style.position="absolute",this.elem.style.width=this.rect[0]+"px",this.elem.style.height=this.rect[1]+"px",this.elem.style.left=this.elemPosition[0]+"%",this.elem.style.bottom=this.elemPosition[1]+"%",this.elem.style.zIndex="100",this.moveElem=document.createElement("div"),this.moveElem.className="move",this.moveElem.style.position="absolute",this.moveElem.style.borderRadius="100%",this.moveElem.style.backgroundColor="#c7c7c7",this.moveElem.style.width=this.moveRect[0]+"px",this.moveElem.style.height=this.moveRect[1]+"px",this.elem.appendChild(this.moveElem),this.moveCenter=this.moveRect.map((function(t){return t/2})),this.elemCenter=this.rect.map((function(t){return t/2})),this.resetPos(),this.bindEvent(),document.body.appendChild(this.elem)}resetPos(){this.toPosition=[0,0],this.transPosition()}transPosition(){let t=this.elemCenter[0]-this.moveCenter[0]+this.toPosition[0],e=this.elemCenter[1]-this.moveCenter[1]-this.toPosition[1];this.moveElem.style.left=t+"px",this.moveElem.style.top=e+"px"}bindEvent(){this.elem.addEventListener("touchstart",function(t){let e=t.touches[0]||t;this.setPosition(e),t.stopPropagation(),t.preventDefault()}.bind(this),!1),this.elem.addEventListener("touchmove",function(t){let e=t.touches[0]||t;this.setPosition(e),t.stopPropagation(),t.preventDefault()}.bind(this),!1),this.elem.addEventListener("touchend",function(t){this.resetPos(),t.stopPropagation(),t.preventDefault()}.bind(this),!1)}setPosition(t){this.position=[this.elem.offsetLeft,this.elem.offsetTop];let e=t.pageX-this.position[0],i=t.pageY-this.position[1],s=e-this.elemCenter[0],n=-(i-this.elemCenter[1]);console.log(s,n);let r=Math.atan2(n,s),o=Math.sqrt(s*s+n*n),a=this.elemCenter[0]-this.moveCenter[0];if(o>a){s=Math.cos(r)*a,n=Math.sin(r)*a}this.toPosition=[s,n],this.transPosition()}getAngle(){return this.angle=Math.atan2(this.toPosition[1],this.toPosition[0]),this.angle}remove(){this.elem.parentNode.removeChild(this.elem)}}},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.img=0]="img",t[t.size=1]="size",t[t.distance=2]="distance"}(s=e.EAnimateType||(e.EAnimateType={}));e.default=class{constructor(t,e,i,n=[]){this.callback=e,this.hero=i,this.list=[],this.index=0,this.speed=10,this.frame=0,this.overframe=1,this.waiteMoment=0,this.loopNum=99999,this.cacheLoopNum=1,this.puase=!1,this.types=[s.img],this.list=t,n&&(this.types=n),0==this.list.length&&(this.list=[{content:this.hero.content,w:this.hero.width,h:this.hero.height}])}setLoopNum(t){this.loopNum=t,this.cacheLoopNum=t}play(t){let e=this.list[this.index],{x:i,y:s}=this.hero;this.frame!=this.speed||this.puase||(this.frame=0,this.index++,e.x&&(i+=e.x),e.y&&(s+=e.y)),this.index==this.list.length&&(this.loopNum--,this.index=0,this.overframe=this.frame,this.waiteMoment&&(this.puase=!0),this.frame-this.overframe==this.waiteMoment&&(this.puase=!1,t&&t(this),this.callback&&this.callback(this))),this.frame++;let n=Object.assign({content:this.hero.content},e,{x:i,y:s});return 0==this.loopNum&&(this.loopNum=this.cacheLoopNum,this.overCallback(this,n)),n}stop(){this.index=0,this.callback&&this.callback()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.attack="attack",t.defense="defense",t.criticalHit="criticalHit"}(e.types||(e.types={})),function(t){t.attack="攻击",t.defense="防御",t.criticalHit="暴击"}(e.typesName||(e.typesName={}));e.default=class{constructor(){this.attack=0,this.defense=0,this.criticalHit=0}setValue(t,e){this[t]+=e}getValue(t){return this[t]}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(1),r=i(0),o=i(3),a=i(4),h=i(3),l=i(17),c=i(6),u=i(18),d=n.lib.createCanvas(),[f,p]=[d.height,d.width];let g=new n.Stage(d,p,f,"#FFFFFF");g.setRealWH(2e3,1e3);let m=new n.Title("测试",g);m.create=t=>{n.lib.write(g,"测试"),t()},new n.Descript(g).create=t=>s(void 0,void 0,void 0,(function*(){n.lib.draw(g,"images/descript.png",0,0,g.realWidth,g.realHeight);let e=new n.Sprite(g,r.SHAPE.text,{text:"开始"},100,40,(g.realWidth-100)/2,g.realHeight/2-20);e.draw(),n.lib.addEventListener(g.canvas,"touchstart",i=>{console.log(1111),e.touchHits(i,()=>{console.log(222),n.lib.removeEventListener(g.canvas,"touchstart"),t()})})}));class y extends n.JY{constructor(){super(...arguments),this.frame=0,this.score=0,this.life=10,this.heros=[],this.rebots=[],this.btns=[]}reset(){this.score=0,this.life=10}newGame(){this.stage.style="#ffffff",this.bg=new u.default,this.bg.create(this.stage),this.reset(),this.setState(n.STATE.running),this.createHero(),n.lib.isMobile()&&this.createControl(),this.onEvent(),this.center=new n.Sprite(g,r.SHAPE.text,{text:"O"},30,30,g.realWidth/2,g.realHeight/2)}createControl(){this.control=new c.default,this.control.create();let{x:t,y:e}=n.lib.transformRelatePosition(this.stage,{x:g.width-70,y:this.stage.height-70}),i=new n.Sprite(g,r.SHAPE.rect,"images/attack.png",60,60,t,e);console.log({x:i.x,y:i.y},{cx:i.cx,cy:i.cy},{x:g.width-100,y:this.stage.height-100}),i.draw(),this.btns.push(i),n.lib.addEventListener(g.canvas,"touchstart",t=>{console.log(1111),i.touchHits(t,()=>{console.log(222),this.currentHero.attack(a.EAttackType.normal)})})}onEvent(){n.lib.addEventListener(window,"keyup",t=>{switch(t.key){case"ArrowRight":case"d":case"ArrowLeft":case"a":case"ArrowUp":case"w":case"ArrowDown":case"s":this.currentHero.status==h.EStatus.runing&&this.currentHero.stop()}}),n.lib.addEventListener(window,"keydown",t=>{switch(t.key){case"ArrowRight":case"d":this.currentHero.move(o.EDirection.right);break;case"ArrowLeft":case"a":this.currentHero.move(o.EDirection.left);break;case"j":case"x":this.currentHero.attack(a.EAttackType.normal);break;case"k":this.currentHero.attack(a.EAttackType.skill)}})}running(){const t=Object.create(null,{running:{get:()=>super.running}});return s(this,void 0,void 0,(function*(){t.running.call(this),this.bg.draw(),this.center.draw(),this.createRebot(),this.showHeros(),this.showRebots(),this.frame++,n.lib.isMobile()&&this.move(),this.drawbtn()}))}drawbtn(){this.btns.forEach(t=>{t.drawAbsolute()})}move(){let t=this.control.getAngle(),e=1*Math.cos(t);return 1==e&&this.currentHero.status==h.EStatus.runing?(this.currentHero.stop(),!1):e>0&&e<1?(this.currentHero.move(o.EDirection.right),!1):e<0&&e>-1?(this.currentHero.move(o.EDirection.left),!1):void 0}showScore(){n.lib.write(g,""+this.life,10,20),n.lib.write(g,""+this.score,10,50)}createHero(){let t=this.stage,e=n.lib.transformRelatePosition(t,{x:t.width/2,y:t.height-100}),i=new o.default(t,r.SHAPE.circle,"",21,57,e.x,e.y);i.heros=this.heros,i.rebots=this.rebots,i.isOwner=!0,i.main=this,this.currentHero=i,this.heros.push(i)}createRebot(t=[]){if(this.frame%500==0||0==this.frame){let t=n.lib.transformRelatePosition(g,{x:n.lib.getRandomItem([0,this.stage.width]),y:g.height-100}),e=new l.default(this.stage,r.SHAPE.rect,"",41,41,t.x,t.y);e.name="rebot",e.speedValue=.3,e.heros=this.heros,e.setLevel(n.lib.generateRandomNumber(this.heros[0].level,.6)),e.rebots=this.rebots,e.target=n.lib.getRandomItem(this.heros),this.rebots.push(e)}this.showRebots()}showRebots(){this.rebots.forEach((t,e)=>{t.visible?t.draw():this.rebots.splice(e,1)})}showHeros(){this.heros.forEach((t,e)=>{t.visible?t.draw():(this.heros.splice(e,1),t==this.currentHero&&this.setState(n.STATE.gameOver))})}unEvent(){n.lib.removeEventListener(window,"keyup"),n.lib.removeEventListener(window,"keydown")}gameOver(){return s(this,void 0,void 0,(function*(){g.clear(),n.lib.write(g,"游戏结束！"),this.unEvent(),yield n.lib.waitMoment(3e3),this.reset(),this.control&&this.control.remove()}))}levelup(){this.pause()}goon(){this.play()}}let v=new y(g,m);v.resources=["images/role.png","images/btn-start.png","images/descript.png","images/attack.png","images/rebot/ghost.png"];for(let t=1;t<=15;t++)v.resources.push(`images/hero/APimg[${t}].png`);v.resources.push("images/hero/APimg[29].png"),v.resources.push("images/hero/APimg[30].png"),v.resources.push("images/hero/APimg[130].png"),v.resources.push("images/hero/APimg[131].png"),v.resources.push("images/hero/APimg[180].png"),v.resources.push("images/hero/APimg[183].png"),v.resources.push("images/hero/APimg[184].png"),v.resources.push("images/skill.png"),v.resources.push("images/bg/bg.jpg"),v.resources.push("images/bg/floor.png"),v.resources.push("images/bg/GObj[216].png"),v.setup(),e.default=y},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),r=i(2);var o;i(5),function(t){t[t.loading=0]="loading",t[t.title=1]="title",t[t.descript=2]="descript",t[t.newGame=3]="newGame",t[t.running=4]="running",t[t.gameOver=5]="gameOver"}(o=e.STATE||(e.STATE={}));e.default=class{constructor(t,e,i,s,n){this.stage=t,this.titleStage=e,this.descriptStage=i,this.gameOverStage=s,this.controlStage=n,this.func=new Function,this.ispause=!1,this.interval=10,this.resources=[],this.context=t.context}setup(){this.stage.draw(),this.currentState=o.loading,this.setState(o.loading),this.loop()}loop(){return s(this,void 0,void 0,(function*(){this.ispause||(yield this.func()),this.aniId=requestAnimationFrame(this.loop.bind(this))}))}createControl(){}newGame(){this.setState(o.running)}over(){this.setState(o.gameOver)}pause(){this.ispause=!0,window.cancelAnimationFrame(this.aniId)}play(){this.ispause=!1,this.loop()}gameOver(){console.log("gameOver"),this.stage.clear(),this.showGameOver()}showGameOver(){return s(this,void 0,void 0,(function*(){console.log("game  over..."),yield r.default.waitMoment(3e3)}))}running(){this.stage.clear(),console.log("running...")}loading(){return s(this,void 0,void 0,(function*(){console.log("loading....");try{yield this.showLoading(),console.log("loading end..."),this.setState(o.title)}catch(t){this.setState(o.title)}}))}showLoading(){return r.default.write(this.stage,"正在加载中"),r.default.loadResources(this.resources)}title(){return s(this,void 0,void 0,(function*(){console.log("title...."),yield this.showTitle(),this.setState(o.descript)}))}showTitle(){return new Promise(t=>{this.titleStage.create(t)})}descript(){return s(this,void 0,void 0,(function*(){console.log("descript...");try{yield this.showDescript(),this.setState(o.newGame)}catch(t){this.setState(o.newGame)}}))}showDescript(){return new Promise(t=>{this.descriptStage?this.descriptStage.create(t):t(!0)})}proxy(t){return this.stage.clear(),t.bind(this)}checkState(){switch(this.currentState){case o.loading:this.func=this.proxy(this.loading);break;case o.title:this.func=this.proxy(this.title);break;case o.descript:this.func=this.proxy(this.descript);break;case o.newGame:this.func=this.proxy(this.newGame);break;case o.running:this.func=this.proxy(this.running);break;case o.gameOver:this.func=this.proxy(this.gameOver)}}setState(t){this.currentState=t,this.checkState()}hits(t,e){var i=!1,s=!1;if(t.type==n.SHAPE.rect){var r=e.width,o=t.width,a=e.height,h=t.height;return i=t.x>e.x?t.x-e.x<r:!(t.x<e.x)||e.x-t.x<o,s=t.y>e.y?t.y-e.y<a:!(t.y<e.y)||e.y-t.y<h,i&&s}if(t.type==n.SHAPE.circle){var l=t.r+e.r;let n=t.getCenter(),r=e.getCenter();return i=Math.abs(n[0]-r[0])<l,s=Math.abs(n[1]-r[1])<l,i&&s}}}},function(t,e){!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){"use strict";if(!window.wx)return{};var s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));var n=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,function(){s.addEventListener=s.canvas.addEventListener=function(t,e){s.document.addEventListener(t,e)},s.removeEventListener=s.canvas.removeEventListener=function(t,e){s.document.removeEventListener(t,e)};var t=wx.getSystemInfoSync().platform;if("undefined"==typeof __devtoolssubcontext&&"devtools"===t){for(var e in s){var i=Object.getOwnPropertyDescriptor(n,e);i&&!0!==i.configurable||Object.defineProperty(window,e,{value:s[e]})}for(var r in s.document){var o=Object.getOwnPropertyDescriptor(n.document,r);o&&!0!==o.configurable||Object.defineProperty(n.document,r,{value:s.document[r]})}window.parent=window}else{for(var a in s)n[a]=s[a];n.window=s,window=n,window.top=window.parent=window}}())},function(t,e,i){"use strict";if(!window.wx)return{};Object.defineProperty(e,"__esModule",{value:!0}),e.cancelAnimationFrame=e.requestAnimationFrame=e.clearInterval=e.clearTimeout=e.setInterval=e.setTimeout=e.canvas=e.location=e.localStorage=e.HTMLElement=e.FileReader=e.Audio=e.Image=e.WebSocket=e.XMLHttpRequest=e.navigator=e.document=void 0;var s=i(2);Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})}));var n=i(3);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));var r=m(i(9)),o=m(i(10)),a=m(i(17)),h=m(i(18)),l=m(i(19)),c=m(i(11)),u=m(i(12)),d=m(i(20)),f=m(i(4)),p=m(i(21)),g=m(i(22));function m(t){return t&&t.__esModule?t:{default:t}}e.document=o.default,e.navigator=a.default,e.XMLHttpRequest=h.default,e.WebSocket=l.default,e.Image=c.default,e.Audio=u.default,e.FileReader=d.default,e.HTMLElement=f.default,e.localStorage=p.default,e.location=g.default;var y=new r.default;e.canvas=y,e.setTimeout=setTimeout,e.setInterval=setInterval,e.clearTimeout=clearTimeout,e.clearInterval=clearInterval,e.requestAnimationFrame=requestAnimationFrame,e.cancelAnimationFrame=cancelAnimationFrame},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=wx.getSystemInfoSync(),s=i.screenWidth,n=i.screenHeight,r=i.devicePixelRatio,o=e.innerWidth=s,a=e.innerHeight=n;e.devicePixelRatio=r;e.screen={availWidth:o,availHeight:a},e.performance={now:function(){return Date.now()/1e3}},e.ontouchstart=null,e.ontouchmove=null,e.ontouchend=null},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLCanvasElement=e.HTMLImageElement=void 0;var s,n=i(4),r=(s=n)&&s.__esModule?s:{default:s};function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.HTMLImageElement=function(t){function e(){return o(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"img"))}return h(e,t),e}(r.default),e.HTMLCanvasElement=function(t){function e(){return o(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"canvas"))}return h(e,t),e}(r.default)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(5),o=(s=r)&&s.__esModule?s:{default:s},a=i(8),h=i(2);var l=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.className="",i.childern=[],i.style={width:h.innerWidth+"px",height:h.innerHeight+"px"},i.insertBefore=a.noop,i.innerHTML="",i.tagName=t.toUpperCase(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"getBoundingClientRect",value:function(){return{top:0,left:0,width:h.innerWidth,height:h.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var t=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(t)?0:t}},{key:"clientHeight",get:function(){var t=parseInt(this.style.fontSize,10);return Number.isNaN(t)?0:t}}]),e}(o.default);e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=i(6);var r=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.className="",t.children=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((s=n)&&s.__esModule?s:{default:s}).default);e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(7);var o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.childNodes=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"appendChild",value:function(t){if(!(t instanceof e))throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),e}(((s=r)&&s.__esModule?s:{default:s}).default);e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var s=new WeakMap,n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s.set(this,{})}return i(t,[{key:"addEventListener",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=s.get(this);n||(n={},s.set(this,n)),n[t]||(n[t]=[]),n[t].push(e),i.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented."),i.once&&console.warn("EventTarget.addEventListener: options.once is not implemented."),i.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(t,e){var i=s.get(this)[t];if(i&&i.length>0)for(var n=i.length;n--;n>0)if(i[n]===e){i.splice(n,1);break}}},{key:"dispatchEvent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=s.get(this)[t.type];if(e)for(var i=0;i<e.length;i++)e[i](t)}}]),t}();e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=wx.createCanvas();t.type="canvas",t.__proto__.__proto__=new s.default("canvas");t.getContext;return t.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}},t};i(3);var s=n(i(4));n(i(10));function n(t){return t&&t.__esModule?t:{default:t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),n=h(i(4)),r=h(i(11)),o=h(i(12)),a=h(i(9));function h(t){return t&&t.__esModule?t:{default:t}}i(15);var l={},c={readyState:"complete",visibilityState:"visible",documentElement:s,hidden:!1,style:{},location:s.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new n.default("head"),body:new n.default("body"),createElement:function(t){return"canvas"===t?new a.default:"audio"===t?new o.default:"img"===t?new r.default:new n.default(t)},getElementById:function(t){return t===s.canvas.id?s.canvas:null},getElementsByTagName:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[s.canvas]:[]},querySelector:function(t){return"head"===t?c.head:"body"===t?c.body:"canvas"===t?s.canvas:t==="#"+s.canvas.id?s.canvas:null},querySelectorAll:function(t){return"head"===t?[c.head]:"body"===t?[c.body]:"canvas"===t?[s.canvas]:[]},addEventListener:function(t,e){l[t]||(l[t]=[]),l[t].push(e)},removeEventListener:function(t,e){var i=l[t];if(i&&i.length>0)for(var s=i.length;s--;s>0)if(i[s]===e){i.splice(s,1);break}},dispatchEvent:function(t){var e=l[t.type];if(e)for(var i=0;i<e.length;i++)e[i](t)}};e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return wx.createImage()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(13),o=(s=r)&&s.__esModule?s:{default:s};var a=0,h=1,l=2,c=3,u=4,d=new WeakMap,f=new WeakMap,p=(new WeakMap,new WeakMap,function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i.HAVE_NOTHING=a,i.HAVE_METADATA=h,i.HAVE_CURRENT_DATA=l,i.HAVE_FUTURE_DATA=c,i.HAVE_ENOUGH_DATA=u,i.readyState=a,f.set(i,"");var s=wx.createInnerAudioContext();return d.set(i,s),s.onCanplay((function(){i.dispatchEvent({type:"load"}),i.dispatchEvent({type:"loadend"}),i.dispatchEvent({type:"canplay"}),i.dispatchEvent({type:"canplaythrough"}),i.dispatchEvent({type:"loadedmetadata"}),i.readyState=l})),s.onPlay((function(){i.dispatchEvent({type:"play"})})),s.onPause((function(){i.dispatchEvent({type:"pause"})})),s.onEnded((function(){i.dispatchEvent({type:"ended"}),i.readyState=u})),s.onError((function(){i.dispatchEvent({type:"error"})})),t&&(d.get(i).src=t),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){d.get(this).play()}},{key:"pause",value:function(){d.get(this).pause()}},{key:"canPlayType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"string"!=typeof t?"":t.indexOf("audio/mpeg")>-1||t.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var t=new e;return t.loop=d.get(this).loop,t.autoplay=d.get(this).loop,t.src=this.src,t}},{key:"currentTime",get:function(){return d.get(this).currentTime},set:function(t){d.get(this).seek(t)}},{key:"src",get:function(){return f.get(this)},set:function(t){f.set(this,t),d.get(this).src=t}},{key:"loop",get:function(){return d.get(this).loop},set:function(t){d.get(this).loop=t}},{key:"autoplay",get:function(){return d.get(this).autoplay},set:function(t){d.get(this).autoplay=t}},{key:"paused",get:function(){return d.get(this).paused}}]),e}(o.default));e.default=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=i(14);var r=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"audio"))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((s=n)&&s.__esModule?s:{default:s}).default);e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(4);var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n(e,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),e}(((s=r)&&s.__esModule?s:{default:s}).default);e.default=o},function(t,e,i){"use strict";i(16)},function(t,e,i){"use strict";var s,n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=i(10),o=(s=r)&&s.__esModule?s:{default:s},a=i(8);var h=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.target=n.canvas,this.currentTarget=n.canvas,this.touches=[],this.targetTouches=[],this.changedTouches=[],this.preventDefault=a.noop,this.stopPropagation=a.noop,this.type=e};function l(t){return function(e){var i=new h(t);i.touches=e.touches,i.targetTouches=Array.prototype.slice.call(e.touches),i.changedTouches=e.changedTouches,i.timeStamp=e.timeStamp,o.default.dispatchEvent(i)}}wx.onTouchStart(l("touchstart")),wx.onTouchMove(l("touchmove")),wx.onTouchEnd(l("touchend")),wx.onTouchCancel(l("touchcancel"))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(8),n={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",onLine:!0,geolocation:{getCurrentPosition:s.noop,watchPosition:s.noop,clearWatch:s.noop}};e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var s=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap;function h(t){if("function"==typeof this["on"+t]){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];this["on"+t].apply(this,i)}}function l(t){this.readyState=t,h.call(this,"readystatechange")}var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,r.set(this,{"content-type":"application/x-www-form-urlencoded"}),o.set(this,{})}return i(t,[{key:"abort",value:function(){var t=a.get(this);t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=o.get(this);return Object.keys(t).map((function(e){return e+": "+t[e]})).join("\n")}},{key:"getResponseHeader",value:function(t){return o.get(this)[t]}},{key:"open",value:function(e,i){n.set(this,e),s.set(this,i),l.call(this,t.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==t.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:i,url:s.get(this),method:n.get(this),header:r.get(this),responseType:this.responseType,success:function(i){var s=i.data,n=i.statusCode,r=i.header;if("string"!=typeof s&&!(s instanceof ArrayBuffer))try{s=JSON.stringify(s)}catch(t){s=s}if(e.status=n,o.set(e,r),h.call(e,"loadstart"),l.call(e,t.HEADERS_RECEIVED),l.call(e,t.LOADING),e.response=s,s instanceof ArrayBuffer){e.responseText="";for(var a=new Uint8Array(s),c=a.byteLength,u=0;u<c;u++)e.responseText+=String.fromCharCode(a[u])}else e.responseText=s;l.call(e,t.DONE),h.call(e,"load"),h.call(e,"loadend")},fail:function(t){var i=t.errMsg;-1!==i.indexOf("abort")?h.call(e,"abort"):h.call(e,"error",i),h.call(e,"loadend")}})}},{key:"setRequestHeader",value:function(t,e){var i=r.get(this);i[t]=e,r.set(this,i)}}]),t}();c.UNSEND=0,c.OPENED=1,c.HEADERS_RECEIVED=2,c.LOADING=3,c.DONE=4,e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();var s=new WeakMap,n=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.binaryType="",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=3,"string"!=typeof e||!/(^ws:\/\/)|(^wss:\/\/)/.test(e))throw new TypeError("Failed to construct 'WebSocket': The URL '"+e+"' is invalid");this.url=e,this.readyState=t.CONNECTING;var r=wx.connectSocket({url:e,protocols:Array.isArray(n)?n:[n]});return s.set(this,r),r.onClose((function(e){i.readyState=t.CLOSED,"function"==typeof i.onclose&&i.onclose(e)})),r.onMessage((function(t){"function"==typeof i.onmessage&&i.onmessage(t)})),r.onOpen((function(){i.readyState=t.OPEN,"function"==typeof i.onopen&&i.onopen()})),r.onError((function(t){"function"==typeof i.onerror&&i.onerror(new Error(t.errMsg))})),this}return i(t,[{key:"close",value:function(e,i){this.readyState=t.CLOSING,s.get(this).close({code:e,reason:i})}},{key:"send",value:function(t){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+t+" is invalid");s.get(this).send({data:t})}}]),t}();n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={get length(){return wx.getStorageInfoSync().keys.length},key:function(t){return wx.getStorageInfoSync().keys[t]},getItem:function(t){return wx.getStorageSync(t)},setItem:function(t,e){return wx.setStorageSync(t,e)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}};e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={href:"game.js",reload:function(){}}}])},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.stage=t,console.log(arguments)}create(t){this.stage.canvas.addEventListener("touchstart",()=>{console.log("touch..."),t()})}remove(){this.stage.clear()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.btntitle=t}create(t,e=""){this.elem=document.createElement("div"),this.elem.className="gameOver",this.textElem=document.createElement("div"),this.textElem.className="text",this.textElem.innerHTML=e,this.elem.appendChild(this.textElem);let i=document.createElement("button");return i.className="button",i.innerText=this.btntitle,i.addEventListener("touchstart",function(e){t.call(this)}.bind(this),!1),this.elem.appendChild(i),this.elem}setText(t=""){this.textElem.innerHTML=t}remove(){this.elem.parentNode.removeChild(this.elem)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.default=class{constructor(t,e,i,s){this.canvas=t,this.width=e,this.height=i,this.style=s,this.center={x:0,y:0},this.deviation={x:0,y:0},this.RelativeCenter={x:0,y:0},this.context=t.getContext("2d"),this.realHeight=this.height,this.realWidth=this.width,this.center={x:this.realWidth/2,y:this.realHeight/2},this.RelativeCenter={x:this.realWidth/2,y:this.realHeight/2}}setRealWH(t,e){this.realHeight=e,this.realWidth=t,this.center={x:this.realWidth/2,y:this.realHeight/2},this.RelativeCenter={x:this.realWidth/2,y:this.realHeight/2}}setDeviation({x:t,y:e},i){if(this.RelativeCenter={x:this.realWidth/2+t,y:this.realHeight/2+e},t=Math.max(Math.min(t,this.center.x-this.width/2),-(this.center.x-this.width/2)),e=Math.max(Math.min(e,this.center.y),-this.center.y),i.x<=this.RelativeCenter.x&&i.direction==s.EDirection.right||i.y<=this.RelativeCenter.y&&i.direction==s.EDirection.down||i.x>=this.RelativeCenter.x&&i.direction==s.EDirection.left)return!1;this.deviation={x:t,y:e}}resetDeviation(){this.context.setTransform(1,0,0,1,0,0)}draw(t){this.context.fillStyle=this.style,this.context.fillRect(0,0,this.width,this.height)}clear(){this.context.clearRect(0,0,this.width,this.height),this.draw()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8),n=i(2),r=i(1),o=i(0),a=[.15,.25,.3,.5,.7,1],h=[s.types.attack,s.types.criticalHit,s.types.defense],l=["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"];e.default=class{constructor(t,e){this.stage=t,this.target=e,this.list=[],this.splist=[];let i=n.default.getRandomUniqueItems(a,3);this.list=[{[n.default.getRandomItem(h)]:i[0]},{[n.default.getRandomItem(h)]:i[1]},{[n.default.getRandomItem(h)]:i[2]}]}draw(t){this.splist=[],this.list.forEach((t,e)=>{let i="";for(let e in t)i+=s.typesName[e]+": "+n.default.decimalToPercent(t[e]);let a=new r.Sprite(this.stage,o.SHAPE.text,{text:i,background:l[e]},100,80,(this.stage.width-300)/2+100*e,(this.stage.height-80)/2);a.isAbsolute=!0,a.draw(),this.splist.push(a)}),n.default.addEventListener(this.stage.canvas,"touchstart",e=>{this.splist.forEach((i,s)=>{i.touchHits(e,()=>{console.log(222),n.default.removeEventListener(this.stage.canvas,"touchstart"),t(this.list[s])})})})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.default=class{constructor(t,e){this.title=t,this.stage=e}create(t){s.default.write(this.stage,this.title),s.default.waitMoment(3e3),t()}remove(){this.stage.clear()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(7),r=i(1),o=i(4);e.default=class extends s.default{constructor(t,e,i,r,o,a,h){super(t,e,i,r,o,a,h),this.displayName="Rebot",this.speedValue=1,this.experience=10,this.attackTime=100,this.attactFrame=0,this.aggressivity=20,this.level=1,this.content="images/rebot/ghost.png",this.animate[s.EStatus.standup]=new n.default([],null,this),this.animate[s.EStatus.runing]=new n.default([],null,this),this.animate[s.EStatus.hit]=new n.default([{content:"images/rebot/ghost.png",w:41,h:41}],null,this),this.animate[s.EStatus.hit].setLoopNum(2),this.animate[s.EStatus.hit].overCallback=()=>{this.status=s.EStatus.runing},this.blue=null,this.status=s.EStatus.runing,this.direction=s.EDirection.left}checkHits(){r.lib.hits(this,this.target)?(this.status=s.EStatus.standup,this.showAttack(o.EAttackType.normal,this.target)):this.status==s.EStatus.standup&&(this.setDirection(),this.status=s.EStatus.runing)}getAggressivity(){return this.aggressivity*Math.pow(1.5,this.level-1)}showAttack(t,e){if(this.frame-this.attactFrame>this.attackTime){this.attactFrame=this.frame;let t=this.getAggressivity();e.setHit(t),e.checkLife()}}setDirection(){this.x>this.target.x?this.direction=s.EDirection.left:this.direction=s.EDirection.right}setLevel(t){this.level=t,this.life=50*Math.pow(1.5,this.level-1),this.maxLife=this.life,this.blood.max=this.maxLife}drawLevel(){}draw(){this.setDirection(),this.checkHits(),this.drawLevel(),super.draw()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1);let r=800,o=164;e.default=class{constructor(){this.bgList=[]}create(t){t.width;let e=0,i=new s.default(t,s.SHAPE.rect,"images/bg/bg.jpg",t.realWidth,t.realHeight,0,0);for(this.bgList.push(i);e*r<t.realWidth;){let i=n.lib.transformRelatePosition(t,{x:e*r,y:t.height-o}),a=new s.default(t,s.SHAPE.rect,"images/bg/floor.png",r,o,e*r,i.y);e++,this.bgList.push(a)}}draw(){this.bgList.forEach(t=>{t.draw()})}}}]);